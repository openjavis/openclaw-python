# è¯¦ç»†å¯¹æ¯”åˆ†æï¼šPython vs TypeScriptç‰ˆæœ¬

**åˆ†ææ—¥æœŸ**: 2026-01-28  
**Pythonç‰ˆæœ¬**: 0.3.0  
**TypeScriptç‰ˆæœ¬**: 2026.1.24-0

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

### æ ¸å¿ƒå·®å¼‚

| ç»´åº¦ | TypeScriptç‰ˆæœ¬ | Pythonç‰ˆæœ¬ | å·®è· |
|------|---------------|-----------|------|
| **Agentå®ç°** | Pi Agent (åµŒå…¥å¼) | è‡ªç ”Runtime | æ¶æ„å®Œå…¨ä¸åŒ |
| **ä»£ç è§„æ¨¡** | 2444ä¸ªTSæ–‡ä»¶ | ~50ä¸ªPYæ–‡ä»¶ | è§„æ¨¡å·®å¼‚å·¨å¤§ |
| **æµ‹è¯•è¦†ç›–** | å¤§é‡å•å…ƒæµ‹è¯• | åŸºæœ¬æ— æµ‹è¯• | æµ‹è¯•ç¼ºå¤±ä¸¥é‡ |
| **åŠŸèƒ½æ·±åº¦** | ç”Ÿäº§çº§ | åŸå‹çº§ | å®Œæˆåº¦å·®è·å¤§ |

---

## 1ï¸âƒ£ Agentå®ç° - æ ¸å¿ƒå·®å¼‚

### TypeScriptç‰ˆæœ¬ï¼šä½¿ç”¨Pi Agent

```typescript
// package.json dependencies
"@mariozechner/pi-agent-core": "0.49.3",
"@mariozechner/pi-ai": "0.49.3",
"@mariozechner/pi-coding-agent": "0.49.3",
"@mariozechner/pi-tui": "0.49.3"
```

**æ¶æ„**:
```
src/agents/
â”œâ”€â”€ pi-embedded-runner/          # Pi Agentè¿è¡Œå™¨ (30+ æ–‡ä»¶)
â”‚   â”œâ”€â”€ run.ts                   # ä¸»è¿è¡Œé€»è¾‘
â”‚   â”œâ”€â”€ attempt.ts               # é‡è¯•é€»è¾‘
â”‚   â”œâ”€â”€ compact.ts               # ä¸Šä¸‹æ–‡å‹ç¼©
â”‚   â”œâ”€â”€ lanes.ts                 # å¹¶å‘æ§åˆ¶
â”‚   â””â”€â”€ model.ts                 # æ¨¡å‹é€‰æ‹©
â”œâ”€â”€ pi-embedded-helpers/         # Piå·¥å…·å‡½æ•° (10+ æ–‡ä»¶)
â”‚   â”œâ”€â”€ bootstrap.ts             # å¼•å¯¼é€»è¾‘
â”‚   â”œâ”€â”€ turns.ts                 # Turnç®¡ç†
â”‚   â”œâ”€â”€ thinking.ts              # æ¨ç†æ¨¡å¼
â”‚   â”œâ”€â”€ errors.ts                # é”™è¯¯å¤„ç†
â”‚   â””â”€â”€ images.ts                # å›¾åƒå¤„ç†
â”œâ”€â”€ pi-embedded-subscribe.ts     # äº‹ä»¶è®¢é˜…
â”œâ”€â”€ pi-extensions/               # Piæ‰©å±• (9ä¸ªæ–‡ä»¶)
â”‚   â””â”€â”€ context-pruning/         # ä¸Šä¸‹æ–‡ä¿®å‰ª
â””â”€â”€ pi-tools.*                   # Piå·¥å…·é€‚é…
```

**ç‰¹æ€§**:
- âœ… å®Œæ•´çš„ä¸Šä¸‹æ–‡çª—å£ç®¡ç†
- âœ… è‡ªåŠ¨failoverå’Œé‡è¯•
- âœ… ä¸Šä¸‹æ–‡å‹ç¼©å’Œä¿®å‰ª
- âœ… å¤šprovider fallback
- âœ… Auth profileç®¡ç†
- âœ… æ¨ç†æ¨¡å¼ï¼ˆthinkingï¼‰
- âœ… å¹¶å‘æ§åˆ¶ï¼ˆlanesï¼‰
- âœ… é”™è¯¯åˆ†ç±»å’Œæ¢å¤

### Pythonç‰ˆæœ¬ï¼šè‡ªç ”Runtime

```python
# clawdbot/agents/
â”œâ”€â”€ runtime.py                   # è‡ªç ”è¿è¡Œæ—¶ (~258è¡Œ)
â”œâ”€â”€ session.py                   # ä¼šè¯ç®¡ç† (~142è¡Œ)
â””â”€â”€ tools/                       # 24ä¸ªå·¥å…·
    â”œâ”€â”€ base.py                  # å·¥å…·åŸºç±»
    â””â”€â”€ ...
```

**æ¶æ„**:
```python
class AgentRuntime:
    def __init__(self, model, api_key):
        # ç®€å•åˆå§‹åŒ–
        
    async def run_turn(self, session, message, tools):
        # åŸºç¡€çš„turnæ‰§è¡Œ
        # åªæ”¯æŒå•æ¬¡è°ƒç”¨
```

**ç‰¹æ€§**:
- âœ… åŸºç¡€LLMè°ƒç”¨ï¼ˆClaude + OpenAIï¼‰
- âœ… ç®€å•çš„å·¥å…·è°ƒç”¨
- âœ… æµå¼å“åº”
- âŒ **æ— ä¸Šä¸‹æ–‡ç®¡ç†**
- âŒ **æ— failoveræœºåˆ¶**
- âŒ **æ— ä¸Šä¸‹æ–‡å‹ç¼©**
- âŒ **æ— é”™è¯¯æ¢å¤**
- âŒ **æ— å¹¶å‘æ§åˆ¶**
- âŒ **æ— auth profile**

### å·®è·æ€»ç»“

| åŠŸèƒ½ | TS (Pi Agent) | Python (è‡ªç ”) |
|------|--------------|--------------|
| ä¸Šä¸‹æ–‡çª—å£ç®¡ç† | âœ… å®Œæ•´ | âŒ æ—  |
| Failover | âœ… å¤šå±‚ | âŒ æ—  |
| ä¸Šä¸‹æ–‡å‹ç¼© | âœ… æ™ºèƒ½ | âŒ æ—  |
| é”™è¯¯åˆ†ç±» | âœ… è¯¦ç»† | âŒ åŸºç¡€ |
| é‡è¯•é€»è¾‘ | âœ… å¤šç­–ç•¥ | âŒ æ—  |
| å¹¶å‘æ§åˆ¶ | âœ… Laneç³»ç»Ÿ | âŒ æ—  |
| Authç®¡ç† | âœ… Profileç³»ç»Ÿ | âŒ ç®€å• |
| æ¨ç†æ¨¡å¼ | âœ… æ”¯æŒ | âŒ æ—  |

**è¯„ä¼°**: Pythonç‰ˆæœ¬æ˜¯ä¸€ä¸ª**æç®€å®ç°**ï¼Œåªæœ‰TSç‰ˆæœ¬åŠŸèƒ½çš„**~15-20%**

---

## 2ï¸âƒ£ å·¥å…·ç³»ç»Ÿå¯¹æ¯”

### TypeScriptç‰ˆæœ¬

```
src/agents/tools/                 # 57ä¸ªæ–‡ä»¶
â”œâ”€â”€ bash-tool.ts                  # å®Œæ•´çš„bashå·¥å…·
â”œâ”€â”€ browser-tool.ts               # Playwrighté›†æˆ
â”œâ”€â”€ canvas-tool.ts                # Canvasç³»ç»Ÿ
â”œâ”€â”€ cron-tool.ts                  # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ file-tools.ts                 # æ–‡ä»¶æ“ä½œ
â”œâ”€â”€ image-tool.ts                 # å›¾åƒç”Ÿæˆ
â”œâ”€â”€ memory-tool.ts                # å‘é‡æœç´¢
â”œâ”€â”€ message-tool.ts               # æ¶ˆæ¯å‘é€
â”œâ”€â”€ nodes-tool.ts                 # èŠ‚ç‚¹å›¾
â”œâ”€â”€ process-tool.ts               # è¿›ç¨‹ç®¡ç†
â”œâ”€â”€ sessions-*.ts                 # å¤šä¸ªä¼šè¯å·¥å…·
â”œâ”€â”€ tts-tool.ts                   # è¯­éŸ³åˆæˆ
â”œâ”€â”€ web-*.ts                      # Webå·¥å…·
â””â”€â”€ ...                           # æ›´å¤š
```

**ç‰¹ç‚¹**:
- âœ… æ¯ä¸ªå·¥å…·éƒ½æœ‰è¯¦ç»†å®ç°
- âœ… å®Œæ•´çš„ç±»å‹å®šä¹‰
- âœ… ä¸°å¯Œçš„é”™è¯¯å¤„ç†
- âœ… å·¥å…·ç­–ç•¥ï¼ˆtool-policy.tsï¼‰
- âœ… å·¥å…·æƒé™æ§åˆ¶
- âœ… æ²™ç®±æ‰§è¡Œç¯å¢ƒ

### Pythonç‰ˆæœ¬

```
clawdbot/agents/tools/            # 20ä¸ªæ–‡ä»¶
â”œâ”€â”€ base.py                       # åŸºç±»
â”œâ”€â”€ bash.py                       # åŸºç¡€bash
â”œâ”€â”€ browser.py                    # æ¡†æ¶å®ç°
â”œâ”€â”€ file_ops.py                   # åŸºç¡€æ–‡ä»¶æ“ä½œ
â”œâ”€â”€ image.py                      # åŸºç¡€å›¾åƒ
â””â”€â”€ ...                           # å…¶ä»–
```

**ç‰¹ç‚¹**:
- âœ… åŸºç¡€åŠŸèƒ½å®ç°
- ğŸš§ ç±»å‹å®šä¹‰ä¸å®Œæ•´
- ğŸš§ é”™è¯¯å¤„ç†ç®€å•
- âŒ æ— å·¥å…·ç­–ç•¥
- âŒ æ— æƒé™æ§åˆ¶
- âŒ æ— æ²™ç®±

### å·¥å…·åŠŸèƒ½å¯¹æ¯”

| å·¥å…· | TSç‰ˆæœ¬ | Pythonç‰ˆæœ¬ | å·®è·è¯´æ˜ |
|------|--------|-----------|---------|
| bash | å®Œæ•´å®ç°+è¿›ç¨‹ç®¡ç† | åŸºç¡€subprocess | ç¼ºå°‘è¿›ç¨‹è¿½è¸ª |
| browser | å®Œæ•´Playwrighté›†æˆ | æ¡†æ¶ä»£ç  | æœªå®é™…æµ‹è¯• |
| file_ops | ä¸°å¯Œçš„æ–‡ä»¶æ“ä½œ | åŸºç¡€è¯»å†™ | åŠŸèƒ½ç®€å• |
| memory | LanceDBå®Œæ•´é›†æˆ | æ¡†æ¶ä»£ç  | æœªå®é™…å®ç° |
| cron | å®Œæ•´è°ƒåº¦ç³»ç»Ÿ | æ¡†æ¶ä»£ç  | éœ€è¦å®ç° |
| canvas | å®Œæ•´UIç³»ç»Ÿ | æ¡†æ¶ä»£ç  | éœ€è¦å®ç° |
| nodes | å®Œæ•´èŠ‚ç‚¹å›¾ | æ¡†æ¶ä»£ç  | éœ€è¦å®ç° |

**è¯„ä¼°**: Pythonå·¥å…·ç³»ç»Ÿçº¦**40-50%å®Œæˆåº¦**

---

## 3ï¸âƒ£ Channelç³»ç»Ÿå¯¹æ¯”

### TypeScriptç‰ˆæœ¬ç»“æ„

```
src/channels/
â”œâ”€â”€ plugins/                      # 69ä¸ªæ–‡ä»¶ï¼
â”‚   â”œâ”€â”€ discord/                  # å®Œæ•´Discordå®ç°
â”‚   â”œâ”€â”€ telegram/                 # å®Œæ•´Telegramå®ç°
â”‚   â”œâ”€â”€ slack/                    # å®Œæ•´Slackå®ç°
â”‚   â”œâ”€â”€ whatsapp/                 # å®Œæ•´WhatsAppå®ç°
â”‚   â”œâ”€â”€ signal/                   # å®Œæ•´Signalå®ç°
â”‚   â”œâ”€â”€ imessage/                 # å®Œæ•´iMessageå®ç°
â”‚   â”œâ”€â”€ line/                     # å®Œæ•´LINEå®ç°
â”‚   â””â”€â”€ ...                       # æ›´å¤š
â”œâ”€â”€ registry.ts                   # Channelæ³¨å†Œä¸­å¿ƒ
â”œâ”€â”€ session.ts                    # Channelä¼šè¯
â”œâ”€â”€ typing.ts                     # è¾“å…¥çŠ¶æ€
â”œâ”€â”€ ack-reactions.ts              # æ¶ˆæ¯ç¡®è®¤
â”œâ”€â”€ allowlist-match.ts            # ç™½åå•åŒ¹é…
â”œâ”€â”€ command-gating.ts             # å‘½ä»¤æ§åˆ¶
â”œâ”€â”€ mention-gating.ts             # æåŠæ§åˆ¶
â””â”€â”€ ...                           # æ›´å¤šåŠŸèƒ½

src/discord/                      # 59ä¸ªæ–‡ä»¶
â”œâ”€â”€ monitor/                      # 20ä¸ªç›‘æ§æ–‡ä»¶
â”œâ”€â”€ api.ts                        # Discord API
â”œâ”€â”€ gateway-logging.ts            # Gatewayæ—¥å¿—
â”œâ”€â”€ audit.ts                      # å®¡è®¡
â””â”€â”€ ...

src/telegram/                     # 75ä¸ªæ–‡ä»¶
src/slack/                        # 64ä¸ªæ–‡ä»¶
src/signal/                       # 24ä¸ªæ–‡ä»¶
src/line/                         # 32ä¸ªæ–‡ä»¶
src/imessage/                     # 16ä¸ªæ–‡ä»¶
```

**æ¯ä¸ªchanneléƒ½æœ‰**:
- âœ… å®Œæ•´çš„APIé›†æˆ
- âœ… æ¶ˆæ¯è§„èŒƒåŒ–
- âœ… é”™è¯¯å¤„ç†
- âœ… é‡è¿é€»è¾‘
- âœ… çŠ¶æ€ç®¡ç†
- âœ… äº‹ä»¶ç›‘å¬
- âœ… æ–‡ä»¶å¤„ç†
- âœ… åª’ä½“æ”¯æŒ
- âœ… å‘½ä»¤è§£æ
- âœ… ç™½åå•/é»‘åå•
- âœ… å®¡è®¡æ—¥å¿—
- âœ… ç›‘æ§å’Œå¥åº·æ£€æŸ¥

### Pythonç‰ˆæœ¬ç»“æ„

```
clawdbot/channels/
â”œâ”€â”€ telegram.py                   # 169è¡Œ
â”œâ”€â”€ discord.py                    # 155è¡Œ
â”œâ”€â”€ slack.py                      # 147è¡Œ
â”œâ”€â”€ whatsapp.py                   # 102è¡Œ
â”œâ”€â”€ signal.py                     # 95è¡Œ
â””â”€â”€ ...                           # å…¶ä»–(æ¯ä¸ª~100è¡Œ)
```

**æ¯ä¸ªchannelç‰¹ç‚¹**:
- âœ… åŸºç¡€æ¡†æ¶ä»£ç 
- ğŸš§ APIè°ƒç”¨æ¡†æ¶
- ğŸš§ åŸºç¡€æ¶ˆæ¯å¤„ç†
- âŒ æ— å®Œæ•´é”™è¯¯å¤„ç†
- âŒ æ— é‡è¿é€»è¾‘
- âŒ æ— çŠ¶æ€ç®¡ç†
- âŒ æ— æ–‡ä»¶å¤„ç†
- âŒ æ— åª’ä½“æ”¯æŒ
- âŒ æ— å‘½ä»¤è§£æ
- âŒ æ— ç™½åå•
- âŒ æ— å®¡è®¡
- âŒ æ— ç›‘æ§

### Channelå®Œæˆåº¦å¯¹æ¯”

| Channel | TSæ–‡ä»¶æ•° | Pythonæ–‡ä»¶æ•° | Pythonå®Œæˆåº¦ |
|---------|---------|-------------|-------------|
| Discord | 59 | 1 | ~10% |
| Telegram | 75 | 1 | ~10% |
| Slack | 64 | 1 | ~10% |
| Signal | 24 | 1 | ~15% |
| LINE | 32 | 1 | ~10% |
| iMessage | 16 | 1 | ~15% |
| WhatsApp | å¤šä¸ªæ–‡ä»¶ | 1 | ~10% |

**è¯„ä¼°**: Python channelç³»ç»Ÿçº¦**10-15%å®Œæˆåº¦**

---

## 4ï¸âƒ£ åŸºç¡€è®¾æ–½å¯¹æ¯”

### TypeScriptç‰ˆæœ¬

```
src/infra/                        # 177ä¸ªæ–‡ä»¶ï¼
â”œâ”€â”€ agent-delivery.ts             # Agentæ¶ˆæ¯æŠ•é€’
â”œâ”€â”€ exec-approvals.ts             # æ‰§è¡Œå®¡æ‰¹
â”œâ”€â”€ heartbeat-runner.ts           # å¿ƒè·³ç›‘æ§
â”œâ”€â”€ state-migrations.ts           # çŠ¶æ€è¿ç§»
â”œâ”€â”€ outbound/                     # å‡ºç«™æ¶ˆæ¯
â””â”€â”€ ...

src/gateway/                      # 184ä¸ªæ–‡ä»¶ï¼
â”œâ”€â”€ server-methods/               # æœåŠ¡å™¨æ–¹æ³•
â”œâ”€â”€ server-chat.ts                # èŠå¤©æœåŠ¡
â”œâ”€â”€ protocol/                     # åè®®å®šä¹‰
â”œâ”€â”€ session-utils.ts              # ä¼šè¯å·¥å…·
â””â”€â”€ ...

src/config/                       # 128ä¸ªæ–‡ä»¶ï¼
â”œâ”€â”€ zod-schema.*.ts               # å¤šä¸ªSchemaæ–‡ä»¶
â”œâ”€â”€ legacy.ts                     # å‘åå…¼å®¹
â”œâ”€â”€ migrations/                   # é…ç½®è¿ç§»
â””â”€â”€ ...

src/memory/                       # 33ä¸ªæ–‡ä»¶
src/cron/                         # 30ä¸ªæ–‡ä»¶
src/daemon/                       # 31ä¸ªæ–‡ä»¶
src/browser/                      # 78ä¸ªæ–‡ä»¶
src/media/                        # å¤šä¸ªæ–‡ä»¶
src/terminal/                     # 11ä¸ªæ–‡ä»¶
src/tts/                          # 2ä¸ªæ–‡ä»¶
src/web/                          # 77ä¸ªæ–‡ä»¶
```

### Pythonç‰ˆæœ¬

```
clawdbot/
â”œâ”€â”€ gateway/                      # 5ä¸ªæ–‡ä»¶
â”‚   â”œâ”€â”€ server.py                 # ç®€å•æœåŠ¡å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ api/                          # 3ä¸ªæ–‡ä»¶
â”‚   â””â”€â”€ http.py                   # åŸºç¡€HTTP API
â”œâ”€â”€ config/                       # 3ä¸ªæ–‡ä»¶
â”‚   â”œâ”€â”€ schema.py                 # ç®€å•Schema
â”‚   â””â”€â”€ loader.py                 # é…ç½®åŠ è½½
â””â”€â”€ cli/                          # 2ä¸ªæ–‡ä»¶
```

### åŸºç¡€è®¾æ–½å·®è·

| ç»„ä»¶ | TSæ–‡ä»¶æ•° | Pythonæ–‡ä»¶æ•° | å·®è· |
|------|---------|-------------|------|
| Gateway | 184 | 5 | å·¨å¤§ |
| Config | 128 | 3 | å·¨å¤§ |
| Infra | 177 | 0 | å®Œå…¨ç¼ºå¤± |
| Memory | 33 | 0 | å®Œå…¨ç¼ºå¤± |
| Cron | 30 | 0 | å®Œå…¨ç¼ºå¤± |
| Browser | 78 | 0 | å®Œå…¨ç¼ºå¤± |
| Media | å¤šä¸ª | 0 | å®Œå…¨ç¼ºå¤± |

**è¯„ä¼°**: åŸºç¡€è®¾æ–½çº¦**5-10%å®Œæˆåº¦**

---

## 5ï¸âƒ£ æµ‹è¯•è¦†ç›–å¯¹æ¯”

### TypeScriptç‰ˆæœ¬

```bash
# æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡
$ find src -name "*.test.ts" | wc -l
300+

# æµ‹è¯•ç±»å‹
- å•å…ƒæµ‹è¯•ï¼šå¤§é‡
- é›†æˆæµ‹è¯•ï¼šå¤šä¸ª
- ç«¯åˆ°ç«¯æµ‹è¯•ï¼šæœ‰
- è¦†ç›–ç‡ï¼šé«˜
```

**æµ‹è¯•ç¤ºä¾‹**:
```
src/agents/
â”œâ”€â”€ auth-profiles.test.ts
â”œâ”€â”€ bash-tools.test.ts
â”œâ”€â”€ cli-session.test.ts
â”œâ”€â”€ identity-file.test.ts
â”œâ”€â”€ model-compat.test.ts
â”œâ”€â”€ pi-embedded-*.test.ts         # å¤šä¸ªæµ‹è¯•
â”œâ”€â”€ sandbox-*.test.ts              # å¤šä¸ªæµ‹è¯•
â””â”€â”€ ...                            # æ›´å¤š

src/discord/
â”œâ”€â”€ api.test.ts
â”œâ”€â”€ audit.test.ts
â”œâ”€â”€ chunk.test.ts
â””â”€â”€ ...                            # 20+æµ‹è¯•

æ¯ä¸ªæ¨¡å—éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•
```

### Pythonç‰ˆæœ¬

```bash
# æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡
$ find clawdbot -name "*test*.py" | wc -l
0

# æ²¡æœ‰ä»»ä½•æµ‹è¯•æ–‡ä»¶ï¼
```

**è¯„ä¼°**: æµ‹è¯•è¦†ç›–**0%**

---

## 6ï¸âƒ£ æ–‡æ¡£å’Œå·¥å…·å¯¹æ¯”

### TypeScriptç‰ˆæœ¬

```
docs/                             # 293ä¸ªæ–‡ä»¶
â”œâ”€â”€ api/                          # APIæ–‡æ¡£
â”œâ”€â”€ cli/                          # CLIæ–‡æ¡£
â”œâ”€â”€ configuration/                # é…ç½®æ–‡æ¡£
â”œâ”€â”€ developers/                   # å¼€å‘è€…æ–‡æ¡£
â”œâ”€â”€ features/                     # åŠŸèƒ½æ–‡æ¡£
â””â”€â”€ ...

scripts/                          # 77ä¸ªæ–‡ä»¶
â”œâ”€â”€ build/                        # æ„å»ºè„šæœ¬
â”œâ”€â”€ release/                      # å‘å¸ƒè„šæœ¬
â”œâ”€â”€ setup/                        # è®¾ç½®è„šæœ¬
â””â”€â”€ ...

å·¥å…·é“¾:
- âœ… TypeScriptç¼–è¯‘
- âœ… ä»£ç æ ¼å¼åŒ–
- âœ… Lintæ£€æŸ¥
- âœ… æµ‹è¯•æ¡†æ¶
- âœ… æ–‡æ¡£ç”Ÿæˆ
- âœ… å‘å¸ƒæµç¨‹
```

### Pythonç‰ˆæœ¬

```
# åªæœ‰åŸºç¡€Markdownæ–‡æ¡£
README.md
QUICKSTART.md
CURRENT_STATUS.md
... (çº¦20ä¸ªæ–‡æ¡£)

# æ²¡æœ‰å¼€å‘å·¥å…·é“¾
```

**è¯„ä¼°**: å·¥å…·é“¾å’Œæµç¨‹çº¦**20%**

---

## 7ï¸âƒ£ å…·ä½“åŠŸèƒ½å·®è·ç»†èŠ‚

### 7.1 ä¸Šä¸‹æ–‡ç®¡ç†

**TypeScript**:
```typescript
// context-window-guard.ts
export function evaluateContextWindowGuard(params: {
  contextTokens: number;
  inputTokens: number;
  systemPromptTokens: number;
  bufferTokens: number;
}) {
  // å¤æ‚çš„ä¸Šä¸‹æ–‡çª—å£ç®¡ç†
  // è‡ªåŠ¨å‹ç¼©å’Œä¿®å‰ª
  // æ™ºèƒ½æˆªæ–­
}

// pi-extensions/context-pruning/
- è‡ªåŠ¨ä¿®å‰ªæ—§æ¶ˆæ¯
- ä¿ç•™é‡è¦ä¸Šä¸‹æ–‡
- æ¸è¿›å¼å‹ç¼©
```

**Python**:
```python
# å®Œå…¨æ²¡æœ‰ä¸Šä¸‹æ–‡ç®¡ç†
# ä¾èµ–LLM APIçš„é»˜è®¤è¡Œä¸º
```

### 7.2 é”™è¯¯å¤„ç†å’ŒFailover

**TypeScript**:
```typescript
// failover-error.ts
export function classifyFailoverReason(error): FailoverReason {
  // è¯¦ç»†çš„é”™è¯¯åˆ†ç±»
}

// pi-embedded-runner/run.ts
export async function runEmbeddedPiAgent(params) {
  // å¤šå±‚failover
  // 1. æ¨¡å‹failover
  // 2. Provider failover  
  // 3. Auth profile failover
  // 4. é™çº§ç­–ç•¥
}
```

**Python**:
```python
# runtime.py
try:
    # ç®€å•çš„try-catch
    result = await self._run_anthropic(...)
except Exception as e:
    logger.error(f"Error: {e}")
    raise  # ç›´æ¥æŠ›å‡º
```

### 7.3 å¹¶å‘æ§åˆ¶

**TypeScript**:
```typescript
// pi-embedded-runner/lanes.ts
export function resolveSessionLane(sessionId: string) {
  // ä¼šè¯çº§åˆ«çš„å¹¶å‘æ§åˆ¶
}

export function resolveGlobalLane(name?: string) {
  // å…¨å±€å¹¶å‘æ§åˆ¶
}

// process/command-queue.ts
- é˜Ÿåˆ—ç®¡ç†
- ä¼˜å…ˆçº§æ§åˆ¶
- è¶…æ—¶å¤„ç†
```

**Python**:
```python
# æ²¡æœ‰å¹¶å‘æ§åˆ¶
# æ‰€æœ‰è¯·æ±‚ç›´æ¥æ‰§è¡Œ
```

### 7.4 Authå’Œå‡­è¯ç®¡ç†

**TypeScript**:
```typescript
// auth-profiles/
â”œâ”€â”€ cooldown.ts                   # å†·å´æœºåˆ¶
â”œâ”€â”€ external-sync.ts              # å¤–éƒ¨åŒæ­¥
â”œâ”€â”€ oauth.ts                      # OAuthå¤„ç†
â”œâ”€â”€ providers.ts                  # Providerç®¡ç†
â””â”€â”€ store.ts                      # å‡­è¯å­˜å‚¨

// ç‰¹æ€§:
- Auth profileè½®æ¢
- å¤±è´¥å†·å´
- è‡ªåŠ¨failover
- å¤–éƒ¨å‡­è¯åŒæ­¥
```

**Python**:
```python
# ç®€å•çš„ç¯å¢ƒå˜é‡
api_key = os.getenv("ANTHROPIC_API_KEY")
```

### 7.5 æ²™ç®±æ‰§è¡Œ

**TypeScript**:
```typescript
// sandbox/
â”œâ”€â”€ agent-config.ts               # Agentæ²™ç®±é…ç½®
â”œâ”€â”€ create-args.ts                # åˆ›å»ºå‚æ•°
â”œâ”€â”€ docker.ts                     # Dockeré›†æˆ
â”œâ”€â”€ runtime-status.ts             # è¿è¡Œæ—¶çŠ¶æ€
â””â”€â”€ ...                           # 17ä¸ªæ–‡ä»¶

// ç‰¹æ€§:
- Dockeréš”ç¦»
- èµ„æºé™åˆ¶
- æƒé™æ§åˆ¶
- å¥åº·æ£€æŸ¥
```

**Python**:
```python
# æ²¡æœ‰æ²™ç®±
# æ‰€æœ‰ä»£ç åœ¨ä¸»è¿›ç¨‹æ‰§è¡Œ
```

---

## 8ï¸âƒ£ ä»£ç è´¨é‡å¯¹æ¯”

### ä»£ç è§„æ¨¡

| ç»´åº¦ | TypeScript | Python | æ¯”ä¾‹ |
|------|-----------|--------|------|
| æ€»æ–‡ä»¶æ•° | 2444 | ~50 | 49:1 |
| Agentæ–‡ä»¶ | 437 | 3 | 146:1 |
| Channelæ–‡ä»¶ | 300+ | 17 | 18:1 |
| åŸºç¡€è®¾æ–½æ–‡ä»¶ | 500+ | 10 | 50:1 |
| æµ‹è¯•æ–‡ä»¶ | 300+ | 0 | âˆ |

### ä»£ç è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | TypeScript | Python |
|------|-----------|--------|
| ç±»å‹å®‰å…¨ | âœ… å®Œæ•´TypeScript | ğŸš§ éƒ¨åˆ†type hints |
| æ–‡æ¡£è¦†ç›– | âœ… é«˜ | ğŸš§ ä¸­ |
| æµ‹è¯•è¦†ç›– | âœ… é«˜ | âŒ æ—  |
| é”™è¯¯å¤„ç† | âœ… å®Œå–„ | ğŸš§ åŸºç¡€ |
| æ—¥å¿—è®°å½• | âœ… è¯¦ç»† | ğŸš§ åŸºç¡€ |
| é…ç½®ç®¡ç† | âœ… SchemaéªŒè¯ | ğŸš§ ç®€å•éªŒè¯ |

---

## 9ï¸âƒ£ å…·ä½“ç¼ºå¤±åŠŸèƒ½æ¸…å•

### å®Œå…¨ç¼ºå¤±çš„åŠŸèƒ½ âŒ

1. **ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿ**
   - ä¸Šä¸‹æ–‡çª—å£guard
   - è‡ªåŠ¨å‹ç¼©
   - æ™ºèƒ½ä¿®å‰ª

2. **Failoveræœºåˆ¶**
   - æ¨¡å‹failover
   - Provider failover
   - Auth failover

3. **å¹¶å‘æ§åˆ¶**
   - Laneç³»ç»Ÿ
   - é˜Ÿåˆ—ç®¡ç†
   - ä¼˜å…ˆçº§æ§åˆ¶

4. **Authç®¡ç†**
   - Profileç³»ç»Ÿ
   - å†·å´æœºåˆ¶
   - è½®æ¢ç­–ç•¥

5. **æ²™ç®±æ‰§è¡Œ**
   - Dockeréš”ç¦»
   - èµ„æºé™åˆ¶
   - æƒé™æ§åˆ¶

6. **ç›‘æ§å’Œå¥åº·æ£€æŸ¥**
   - Heartbeat
   - å¥åº·çŠ¶æ€
   - å®¡è®¡æ—¥å¿—

7. **åª’ä½“å¤„ç†**
   - å›¾åƒç†è§£
   - éŸ³é¢‘å¤„ç†
   - æ–‡ä»¶å­˜å‚¨

8. **é«˜çº§AgentåŠŸèƒ½**
   - æ¨ç†æ¨¡å¼
   - Subagent
   - Agenté—´é€šä¿¡

### éƒ¨åˆ†å®ç°çš„åŠŸèƒ½ ğŸš§

1. **å·¥å…·ç³»ç»Ÿ** (~40%)
   - âœ… åŸºç¡€å·¥å…·
   - ğŸš§ é«˜çº§å·¥å…·æœªå®Œæ•´å®ç°
   - âŒ æ— å·¥å…·ç­–ç•¥
   - âŒ æ— æƒé™æ§åˆ¶

2. **Channelç³»ç»Ÿ** (~15%)
   - âœ… åŸºç¡€æ¡†æ¶
   - ğŸš§ APIè°ƒç”¨æ¡†æ¶
   - âŒ å®Œæ•´åŠŸèƒ½ç¼ºå¤±

3. **Gateway** (~30%)
   - âœ… WebSocketæœåŠ¡å™¨
   - ğŸš§ HTTP API
   - âŒ é«˜çº§åŠŸèƒ½ç¼ºå¤±

4. **é…ç½®ç³»ç»Ÿ** (~50%)
   - âœ… åŸºç¡€é…ç½®
   - ğŸš§ SchemaéªŒè¯
   - âŒ è¿ç§»ç³»ç»Ÿç¼ºå¤±

---

## ğŸ”Ÿ æ€§èƒ½å’Œç¨³å®šæ€§å¯¹æ¯”

### TypeScriptç‰ˆæœ¬

**ç‰¹æ€§**:
- âœ… ç»è¿‡å¤§é‡ç”Ÿäº§æµ‹è¯•
- âœ… é”™è¯¯æ¢å¤æœºåˆ¶å®Œå–„
- âœ… èµ„æºç®¡ç†è‰¯å¥½
- âœ… å¹¶å‘æ§åˆ¶å®Œæ•´
- âœ… å†…å­˜ç®¡ç†ä¼˜åŒ–
- âœ… è¿æ¥æ± ç®¡ç†

**å¯é æ€§**:
- âœ… é‡è¿æœºåˆ¶
- âœ… çŠ¶æ€æŒä¹…åŒ–
- âœ… å´©æºƒæ¢å¤
- âœ… æ•°æ®ä¸€è‡´æ€§

### Pythonç‰ˆæœ¬

**ç‰¹æ€§**:
- ğŸš§ æœªç»ç”Ÿäº§æµ‹è¯•
- ğŸš§ åŸºç¡€é”™è¯¯å¤„ç†
- âŒ æ— èµ„æºç®¡ç†
- âŒ æ— å¹¶å‘æ§åˆ¶
- âŒ æ— å†…å­˜ä¼˜åŒ–
- âŒ æ— è¿æ¥æ± 

**å¯é æ€§**:
- ğŸš§ ç®€å•é‡è¿
- ğŸš§ åŸºç¡€æŒä¹…åŒ–
- âŒ æ— å´©æºƒæ¢å¤
- ğŸš§ æ•°æ®ä¸€è‡´æ€§æœªéªŒè¯

---

## ğŸ“Š æ€»ä½“è¯„ä¼°

### å®Œæˆåº¦çŸ©é˜µ

| ç»„ä»¶ | TSåŸºå‡† | Pythonå®ç° | å®Œæˆåº¦ | è¯„çº§ |
|------|--------|-----------|--------|------|
| **Agent Runtime** | Pi Agent (å®Œæ•´) | è‡ªç ”(ç®€åŒ–) | 15-20% | â­ |
| **å·¥å…·ç³»ç»Ÿ** | 57æ–‡ä»¶ | 20æ–‡ä»¶ | 40-50% | â­â­ |
| **Channelç³»ç»Ÿ** | 300+æ–‡ä»¶ | 17æ–‡ä»¶ | 10-15% | â­ |
| **åŸºç¡€è®¾æ–½** | 500+æ–‡ä»¶ | 10æ–‡ä»¶ | 5-10% | â­ |
| **Gateway** | 184æ–‡ä»¶ | 5æ–‡ä»¶ | 20-30% | â­â­ |
| **é…ç½®ç³»ç»Ÿ** | 128æ–‡ä»¶ | 3æ–‡ä»¶ | 30-40% | â­â­ |
| **æµ‹è¯•** | 300+æµ‹è¯• | 0æµ‹è¯• | 0% | âŒ |
| **æ–‡æ¡£** | 293æ–‡ä»¶ | 20æ–‡ä»¶ | 60-70% | â­â­â­ |

### æ€»ä½“è¯„åˆ†

```
ä»£ç å®Œæˆåº¦:     20-30%  â­â­
åŠŸèƒ½å®Œæˆåº¦:     15-25%  â­
ç”Ÿäº§å°±ç»ªåº¦:     10-15%  â­
æµ‹è¯•è¦†ç›–:       0%      âŒ
æ–‡æ¡£å®Œæ•´æ€§:     60-70%  â­â­â­

ç»¼åˆè¯„ä¼°:       20-25%  â­â­
```

### å¦‚æœè¦è¾¾åˆ°çœŸæ­£çš„80-90%

éœ€è¦è¡¥å……çš„å·¥ä½œé‡ä¼°ç®—ï¼š

1. **Agentç³»ç»Ÿé‡æ„** - 3-4ä¸ªæœˆ
   - å®ç°ä¸Šä¸‹æ–‡ç®¡ç†
   - å®ç°failoveræœºåˆ¶
   - å®ç°å¹¶å‘æ§åˆ¶

2. **Channelç³»ç»Ÿå®Œå–„** - 2-3ä¸ªæœˆ
   - æ¯ä¸ªchannelå®Œæ•´å®ç°
   - æ·»åŠ é”™è¯¯å¤„ç†
   - å®ç°ç›‘æ§

3. **åŸºç¡€è®¾æ–½è¡¥é½** - 2-3ä¸ªæœˆ
   - å®ç°infraæ¨¡å—
   - æ·»åŠ memoryç³»ç»Ÿ
   - å®ç°cronç³»ç»Ÿ

4. **æµ‹è¯•ä½“ç³»å»ºç«‹** - 1-2ä¸ªæœˆ
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - ç«¯åˆ°ç«¯æµ‹è¯•

5. **å·¥å…·å’Œæ²™ç®±** - 1-2ä¸ªæœˆ
   - å®Œå–„å·¥å…·ç³»ç»Ÿ
   - å®ç°æ²™ç®±

**æ€»è®¡**: 9-14ä¸ªæœˆçš„å·¥ä½œé‡

---

## ğŸ’¡ å»ºè®®å’Œç»“è®º

### ç°çŠ¶

Pythonç‰ˆæœ¬æ˜¯ä¸€ä¸ª**æ¦‚å¿µéªŒè¯/åŸå‹çº§åˆ«**çš„å®ç°ï¼Œè€ŒTypeScriptç‰ˆæœ¬æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§**çš„ç³»ç»Ÿã€‚

### ä¼˜åŠ¿

Pythonç‰ˆæœ¬çš„ä¼˜åŠ¿ï¼š
- âœ… ä»£ç ç®€æ´æ˜“è¯»
- âœ… ç‹¬ç«‹è‡ªä¸»ï¼ˆä¸ä¾èµ–Pi Agentï¼‰
- âœ… Pythonç”Ÿæ€ä¸°å¯Œ
- âœ… å­¦ä¹ æˆæœ¬ä½

### åŠ£åŠ¿

Pythonç‰ˆæœ¬çš„åŠ£åŠ¿ï¼š
- âŒ åŠŸèƒ½æ·±åº¦ä¸è¶³
- âŒ ç”Ÿäº§çº§ç‰¹æ€§ç¼ºå¤±
- âŒ é”™è¯¯å¤„ç†ä¸å®Œå–„
- âŒ æ— æµ‹è¯•è¦†ç›–
- âŒ ç¨³å®šæ€§æœªéªŒè¯

### å»ºè®®

1. **çŸ­æœŸï¼ˆ1-3ä¸ªæœˆï¼‰**
   - è¡¥å……æ ¸å¿ƒæµ‹è¯•
   - å®Œå–„é”™è¯¯å¤„ç†
   - å®ç°åŸºç¡€ç›‘æ§

2. **ä¸­æœŸï¼ˆ3-6ä¸ªæœˆï¼‰**
   - å®ç°ä¸Šä¸‹æ–‡ç®¡ç†
   - æ·»åŠ failoveræœºåˆ¶
   - å®Œå–„channelå®ç°

3. **é•¿æœŸï¼ˆ6-12ä¸ªæœˆï¼‰**
   - è¾¾åˆ°ç”Ÿäº§çº§ç¨³å®šæ€§
   - è¡¥é½æ‰€æœ‰åŸºç¡€è®¾æ–½
   - å»ºç«‹å®Œæ•´æµ‹è¯•ä½“ç³»

### ä½¿ç”¨å»ºè®®

**é€‚åˆä½¿ç”¨Pythonç‰ˆæœ¬çš„åœºæ™¯**:
- æœ¬åœ°ä¸ªäººä½¿ç”¨
- å­¦ä¹ å’Œå®éªŒ
- å¿«é€ŸåŸå‹å¼€å‘
- åŠŸèƒ½éªŒè¯

**ä¸é€‚åˆçš„åœºæ™¯**:
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- å¤šç”¨æˆ·æœåŠ¡
- å…³é”®ä¸šåŠ¡åº”ç”¨
- éœ€è¦é«˜å¯é æ€§çš„åœºæ™¯

---

**ç»“è®º**: Pythonç‰ˆæœ¬ç›®å‰æ˜¯ä¸€ä¸ª**çº¦20-25%å®Œæˆåº¦**çš„åŸå‹å®ç°ï¼Œè·ç¦»TypeScriptç‰ˆæœ¬çš„åŠŸèƒ½æ·±åº¦å’Œç”Ÿäº§çº§è´¨é‡è¿˜æœ‰å¾ˆå¤§å·®è·ã€‚ä½†ä½œä¸ºå­¦ä¹ é¡¹ç›®å’Œä¸ªäººå·¥å…·ï¼Œå·²ç»å…·å¤‡åŸºç¡€å¯ç”¨æ€§ã€‚

**ç‰ˆæœ¬**: 0.3.0  
**åˆ†ææ—¥æœŸ**: 2026-01-28  
**è¯„ä¼°äºº**: è¯¦ç»†æŠ€æœ¯å¯¹æ¯”
